#'   pathogen/strain/variant (3rd dimension)
#'
#' @export
#'
#' @examples
#' n_v <- 3 # 3 variants
#' n_loc <- 1 # 1 location
#' T <- 100 # 100 time steps
#' # constant incidence 10 per day everywhere
#' incid <- array(10, dim = c(T, n_loc, n_v))
#' process_I_multivariant(incid)
#'
process_I_multivariant <- function(incid, incid_imported = NULL) {
if (is.null(incid_imported)) {
incid_imported <- incid
## only cases at first time step are imported
incid_imported[-1, , ] <- 0
}
dim1 <- dim(incid)
dim2 <- dim(incid_imported)
if (length(dim1) != length(dim2) || !all(dim1 == dim2)) {
stop("'incid' and 'incid_imported' have incompatible dimensions")
}
incid_local <- incid - incid_imported
res <- list(local = incid_local, imported = incid_imported)
class(res) <- "incid_multivariant"
res
}
## TODO: check dimensions of objects is correct everywhere
## TODO: fix number of variants to be 2
res <- estimate_R(
incid = dat$I,
method = "parametric_si",
config = make_config(list(
mean_si = mean_si,
std_si = std_si
)),
dt=7L
)
gamma_mucv2shapescale
install.packages("epitrix")
res <- estimate_R(
incid = dat$I,
method = "parametric_si",
config = make_config(list(
mean_si = mean_si,
std_si = std_si
)),
dt=7L
)
library(epitrix)
res <- estimate_R(
incid = dat$I,
method = "parametric_si",
config = make_config(list(
mean_si = mean_si,
std_si = std_si
)),
dt=7L
)
distcrete
install.packages("distcrete")
library(distcrete)
res <- estimate_R(
incid = dat$I,
method = "parametric_si",
config = make_config(list(
mean_si = mean_si,
std_si = std_si
)),
dt=7L
)
XX=res$R
plot(res)
library(discrete)
library(distcrete)
library(EpiEstim)
library(epitrix)
library(distcrete)
setwd("~/Documents/GitHub/recent_influenza/Untitled")
source("source_code_Rt_aggregated.R")
source("source_code_epiestim_r_function.R")
source("source_code_epiestim_processes.R")
flu_net_data<-read.csv("data/final/flunet_h3_cases_historic.csv")
#get the total sums:
incidence_weekly<-flu_net_data$flu_pos_sum
mean_si <- 3.6
std_si  <- 1.6
method <- "parametric_si"
config <- make_config(list(mean_si = mean_si,
std_si = std_si))
dat<-data.frame("dataes"=flu_net_data$date,"I"=flu_net_data$flu_pos_sum)
t_start = seq(2, length(nrow(dat))-1)
t_end = t_start+1
res <- estimate_R(
incid = dat$I,
method = "parametric_si",
config = make_config(list(
mean_si = mean_si,
std_si = std_si
)),
dt=7L
)
XX=res$R
plot(res)
res
# Create a ggplot
ggplot(XX, aes(x = t_end, y = `Mean(R)`)) +
geom_line(color = "blue") +
geom_ribbon(aes(ymin = `Quantile.0.025(R)`, ymax = `Quantile.0.975(R)`), alpha = 0.2) +
labs(x = "Time", y = "R", title = "Estimated R") +
theme_minimal() +
theme(legend.position = "bottom")
library(ggplot2)
# Extract R estimates
XX <- res$R
# Create a ggplot
ggplot(XX, aes(x = t_end, y = `Mean(R)`)) +
geom_line(color = "blue") +
geom_ribbon(aes(ymin = `Quantile.0.025(R)`, ymax = `Quantile.0.975(R)`), alpha = 0.2) +
labs(x = "Time", y = "R", title = "Estimated R") +
theme_minimal() +
theme(legend.position = "bottom")
# Plot the default graph
plot(res)
# Add a legend at the bottom manually
legend("bottom",
legend = c("Mean R", "95% CI"),
col = c("black", "gray"),
lty = c(1, 2),
horiz = TRUE,
bty = "n")
# Plot the default graph
plot(res)
# Add a legend at the bottom manually
legend("bottom",
legend = c("Mean R", "95% CI"),
col = c("black", "gray"),
lty = c(1, 2),
horiz = TRUE,
bty = "n")
# Create a ggplot
ggplot(XX, aes(x = t_end, y = `Mean(R)`)) +
geom_line(color = "blue") +
geom_ribbon(aes(ymin = `Quantile.0.025(R)`, ymax = `Quantile.0.975(R)`), alpha = 0.2) +
labs(x = "Time", y = "R", title = "Estimated R") +
geom_hline(yintercept = 1, linetype = "dashed", color = "red") +  # <-- horizontal line
theme_minimal() +
theme(legend.position = "bottom")
res <- estimate_R(
incid = dat,
method = "parametric_si",
config = make_config(list(
mean_si = mean_si,
std_si = std_si
)),
dt=7L
)
plot(dat$dataes,res)
flu_net_data<-read.csv("data/final/flunet_h3_cases_historic.csv")
#get the total sums:
incidence_weekly<-flu_net_data$flu_pos_sum
mean_si <- 3.6
std_si  <- 1.6
method <- "parametric_si"
config <- make_config(list(mean_si = mean_si,
std_si = std_si))
dat<-data.frame("dataes"=flu_net_data$date,"I"=flu_net_data$flu_pos_sum)
t_start = seq(2, length(nrow(dat))-1)
t_end = t_start+1
res <- estimate_R(
incid = dat$I,
method = "parametric_si",
config = make_config(list(
mean_si = mean_si,
std_si = std_si
)),
dt=7L
)
setwd("~/Documents/GitHub/recent_influenza/Untitled")
library(EpiEstim)
library(epitrix)
library(distcrete)
library(ggplot2)
setwd("~/Documents/GitHub/recent_influenza/Untitled")
source("source_code_Rt_aggregated.R")
source("source_code_epiestim_r_function.R")
source("source_code_epiestim_processes.R")
flu_net_data<-read.csv("data/final/flunet_h3_cases_historic.csv")
source("source_code_Rt_aggregated.R")
source("source_code_epiestim_r_function.R")
source("source_code_epiestim_processes.R")
flu_net_data<-read.csv("data/final/flunet_h3_cases_historic.csv")
#get the total sums:
incidence_weekly<-flu_net_data$flu_pos_sum
# Extract Rt estimates and dates
rt_df <- data.frame(
date = res_total$dates,
Rt_mean = res_total$R$`Mean(R)`,
Rt_low = res_total$R$`Quantile.0.025(R)`,
Rt_high = res_total$R$`Quantile.0.975(R)`
)
res_total <- estimate_R(
incid = dat$I,
method = "parametric_si",
config = make_config(list(
mean_si = mean_si,
std_si = std_si
)),
dt=7L
)
mean_si <- 3.6
std_si  <- 1.6
method <- "parametric_si"
config <- make_config(list(mean_si = mean_si,
std_si = std_si))
dat<-data.frame("dataes"=flu_net_data$date,"I"=flu_net_data$flu_pos_sum)
res_total <- estimate_R(
incid = dat$I,
method = "parametric_si",
config = make_config(list(
mean_si = mean_si,
std_si = std_si
)),
dt=7L
)
XX=res$R
plot(res)
XX=res_total$R
plot(res_total)
# Plot the default graph
plot(res_total)
library(dplyr)
library(lubridate)
library(ggplot2)
# Extract Rt estimates and dates
rt_df <- data.frame(
date = res_total$dates,
Rt_mean = res_total$R$`Mean(R)`,
Rt_low = res_total$R$`Quantile.0.025(R)`,
Rt_high = res_total$R$`Quantile.0.975(R)`
)
View(XX)
View(dat)
View(flu_net_data)
# Extract Rt estimates and dates
rt_df <- data.frame(
date = res_total$dates,
Rt_mean = res_total$R$`Mean(R)`,
Rt_low = res_total$R$`Quantile.0.025(R)`,
Rt_high = res_total$R$`Quantile.0.975(R)`
)
View(XX)
# Extract t_start and t_end
t_start <- res_total$R$t_start
t_end <- res_total$R$t_end
# Map to actual dates from your original data
dates <- flu_net_data$date  # assuming this is your original date vector
# Create a data frame with start and end dates for each window
window_dates <- data.frame(
start_date = dates[t_start],
end_date = dates[t_end]
)
window_dates
rt_df <- data.frame(
week = window_dates$week,
Rt_mean = res_total$R$`Mean(R)`,
Rt_low = res_total$R$`Quantile.0.025(R)`,
Rt_high = res_total$R$`Quantile.0.975(R)`
)
window_dates$week
# Extract t_start and t_end
t_start <- res_total$R$t_start
t_end <- res_total$R$t_end
# Map to actual dates from your original data
dates <- flu_net_data$date  # assuming this is your original date vector
# Create a data frame with start and end dates for each window
window_dates <- data.frame(
start_date = dates[t_start],
end_date = dates[t_end]
)
# Convert to week start (or ISO week)
window_dates$week_start <- floor_date(window_dates$start_date, unit = "week")
window_dates$week_end <- floor_date(window_dates$end_date, unit = "week")
# Extract R estimates
XX <- res_total$R
# Create a ggplot
ggplot(XX, aes(x = t_end, y = `Mean(R)`)) +
geom_line(color = "blue") +
geom_ribbon(aes(ymin = `Quantile.0.025(R)`, ymax = `Quantile.0.975(R)`), alpha = 0.2) +
labs(x = "Time", y = "R", title = "Estimated R") +
geom_hline(yintercept = 1, linetype = "dashed", color = "red") +  # <-- horizontal line
theme_minimal() +
theme(legend.position = "bottom")
t_end
View(flu_net_data)
# Extract t_end from res_total
t_end <- res_total$R$t_end
# Map to week and year in flu_net_data
weeks_vector <- paste(flu_net_data$year[t_end], flu_net_data$week[t_end], sep = "-")
# Filter starting from week 2 of 2012
start_index <- which(flu_net_data$year[t_end] == 2012 & flu_net_data$week[t_end] == 2)[1]
weeks_vector <- weeks_vector[start_index:length(weeks_vector)]
# Check result
head(weeks_vector)
years <- 2012:2025
week_sequence <- unlist(lapply(years, function(y) paste(y, seq(1, 52), sep = "-")))
week_sequence
length(week_sequence)
# Create a ggplot
ggplot(XX, aes(x = t_start, y = `Mean(R)`)) +
geom_line(color = "blue") +
geom_ribbon(aes(ymin = `Quantile.0.025(R)`, ymax = `Quantile.0.975(R)`), alpha = 0.2) +
labs(x = "Time", y = "R", title = "Estimated R") +
geom_hline(yintercept = 1, linetype = "dashed", color = "red") +  # <-- horizontal line
theme_minimal() +
theme(legend.position = "bottom")
# Plot the default graph
plot(res_total)
res_total <- estimate_R(
incid = flu_net_data$H3_sum,
method = "parametric_si",
config = make_config(list(
mean_si = mean_si,
std_si = std_si
)),
dt=7L
)
flu_net_data$H3_sum
res_total <- estimate_R(
incid = flu_net_data$H3_sum,
method = "parametric_si",
config = make_config(list(
mean_si = mean_si,
std_si = std_si
)),
dt=7L
)
is.na(flu_net_data$H3_sum)
sum(flu_net_data$H3_sum)
sum(flu_net_data$H3_sum*!)
sum(flu_net_data$H3_sum*1)
sum((flu_net_data$H3_sum)*1)
sum(is.na(flu_net_data$H3_sum)*1)
flu_net_data$H3_sum[is.na(incid_df$H3_sum)] <- 0
flu_net_data$H3_sum[is.na(flu_net_data$H3_sum)] <- 0
sum(is.na(flu_net_data$H3_sum)*1)
res_total <- estimate_R(
incid = flu_net_data$H3_sum,
method = "parametric_si",
config = make_config(list(
mean_si = mean_si,
std_si = std_si
)),
dt=7L
)
flu_net_data$H3_sum[is.na(flu_net_data$H3_sum)] <- 0
res_h3 <- estimate_R(
incid = flu_net_data$H3_sum,
method = "parametric_si",
config = make_config(list(
mean_si = mean_si,
std_si = std_si
)),
dt=7L
)
library(EpiEstim)
View(estimate_R
)
setwd("~/Documents/GitHub/recent_influenza/Untitled")
source("source_code_Rt_aggregated.R")
source("source_code_epiestim_r_function.R")
source("source_code_epiestim_processes.R")
flu_net_data<-read.csv("data/final/flunet_h3_cases_historic.csv")
#get the total sums:
incidence_weekly<-flu_net_data$flu_pos_sum
mean_si <- 3.6
std_si  <- 1.6
method <- "parametric_si"
config <- make_config(list(mean_si = mean_si,
std_si = std_si))
dat<-data.frame("dataes"=flu_net_data$date,"I"=flu_net_data$flu_pos_sum)
res_total <- estimate_R(
incid = dat$I,
method = "parametric_si",
config = make_config(list(
mean_si = mean_si,
std_si = std_si
)),
dt=7L
)
XX=res_total$R
plot(res_total)
# Plot the default graph
plot(res_total)
flu_net_data$H3_sum[is.na(flu_net_data$H3_sum)] <- 0
res_h3 <- estimate_R(
incid = flu_net_data$H3_sum,
method = "parametric_si",
config = make_config(list(
mean_si = mean_si,
std_si = std_si
)),
dt=7L
)
#england cases:
england_cases<-read.csv("data/final/england_h3_cases_historic.csv")
englan_cases<-estimate_R(
incid = england_cases$Influenza.A.H3N2,
method = "parametric_si",
config = make_config(list(
mean_si = mean_si,
std_si = std_si
)),
dt=7L
)
plot(englan_cases)
estimate_R
englan_cases<-estimate_R(
incid = england_cases$Influenza.A.H3N2,
method = "parametric_si",
config = make_config(list(
mean_si = mean_si,
std_si = std_si
)),
dt=7L,
iter=20L
)
plot(englan_cases)
warnings()
View(england_cases)
total_cases<-sum(england_cases[,2:5])
total_eng_cases<-estimate_R(
incid = total_cases,
method = "parametric_si",
config = make_config(list(
mean_si = mean_si,
std_si = std_si
)),
dt=7L,
iter=20L
)
length(total_cases)
total_cases
total_cases<-rowSums(england_cases[,2:5])
total_cases
total_eng_cases<-estimate_R(
incid = total_cases,
method = "parametric_si",
config = make_config(list(
mean_si = mean_si,
std_si = std_si
)),
dt=7L,
iter=20L
)
plot(total_eng_cases)
# Create a ggplot
ggplot(englan_cases, aes(x = t_start, y = `Mean(R)`)) +
geom_line(color = "blue") +
geom_ribbon(aes(ymin = `Quantile.0.025(R)`, ymax = `Quantile.0.975(R)`), alpha = 0.2) +
labs(x = "Time", y = "R", title = "Estimated R") +
geom_hline(yintercept = 1, linetype = "dashed", color = "red") +  # <-- horizontal line
theme_minimal() +
theme(legend.position = "bottom")
# Create a ggplot
ggplot(englan_cases$R, aes(x = t_start, y = `Mean(R)`)) +
geom_line(color = "blue") +
geom_ribbon(aes(ymin = `Quantile.0.025(R)`, ymax = `Quantile.0.975(R)`), alpha = 0.2) +
labs(x = "Time", y = "R", title = "Estimated R") +
geom_hline(yintercept = 1, linetype = "dashed", color = "red") +  # <-- horizontal line
theme_minimal() +
theme(legend.position = "bottom")
# Create a ggplot
ggplot() +
geom_line(englan_cases$R, aes(x = t_start, y = `Mean(R)`),color = "blue") +
geom_ribbon(aes(ymin = `Quantile.0.025(R)`, ymax = `Quantile.0.975(R)`), alpha = 0.2) +
labs(x = "Time", y = "R", title = "Estimated R") +
geom_hline(yintercept = 1, linetype = "dashed", color = "red") +  # <-- horizontal line
theme_minimal() +
theme(legend.position = "bottom")
ggplot(englan_cases$R, aes(x = t_start, y = `Mean(R)`)) +
geom_line(color = "blue") +
geom_line(data = total_eng_cases$R,aes(x = t_start, y = `Mean(R)`), color="red")
#install.packages("devtools")
devtools::install_github("ImperialCollegeLondon/epidemia")
install.packages("hrbrthemes")
install.packages("hrbrthemes")
remotes::install_git("https://codeberg.org/hrbrmstr/hrbrthemes.git")
#install.packages("devtools")
devtools::install_github("ImperialCollegeLondon/epidemia")
detach("package:distcrete", unload = TRUE)
install.packages(c(
"rstan", "StanHeaders", "Rcpp", "RcppEigen", "BH", "RcppParallel", "inline"
))
install.packages(c(
"rstan", "StanHeaders", "Rcpp", "RcppEigen", "BH", "RcppParallel", "inline"
))
# optionally update everything
update.packages(ask = FALSE)
devtools::install_github("ImperialCollegeLondon/epidemia")
sessionInfo()
xcode-select --install
#install.packages("devtools")
devtools::install_github("ImperialCollegeLondon/epidemia")
# update key packages first
install.packages(c("rstan", "StanHeaders", "RcppEigen", "BH"), dependencies = TRUE)
# then try reinstalling epidemia again
devtools::install_github("ImperialCollegeLondon/epidemia", dependencies = TRUE)
git clone https://github.com/ImperialCollegeLondon/epidemia.git
#install.packages("devtools")
devtools::install_github("ImperialCollegeLondon/epidemia")
